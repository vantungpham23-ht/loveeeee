import{s as o}from"./yeyBXsSr.js";function c(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let r="";for(let t=0;t<8;t++)r+=e.charAt(Math.floor(Math.random()*e.length));return r}async function u(){try{const{data:{user:e}}=await o.auth.getUser();if(!e)return null;const{data:r,error:t}=await o.from("couples").select(`
				*,
				user1:user1_id(id, email),
				user2:user2_id(id, email)
			`).or(`user1_id.eq.${e.id},user2_id.eq.${e.id}`).single();if(t){if(t.code==="PGRST116")return null;throw t}return r}catch(e){return console.error("Error getting current couple:",e),null}}async function d(e,r){try{const{data:{user:t}}=await o.auth.getUser();if(!t)throw new Error("User not authenticated");if(await u())throw new Error("User already has a couple");const n=c(),{data:s,error:i}=await o.from("couples").insert({user1_id:t.id,couple_name:e,start_date:r,invite_code:n,status:"pending"}).select().single();if(i)throw i;return s}catch(t){throw console.error("Error creating couple:",t),t}}async function p(e){try{const{data:{user:r}}=await o.auth.getUser();if(!r)throw new Error("User not authenticated");if(await u())throw new Error("User already has a couple");const{data:a,error:n}=await o.from("couples").select("*").eq("invite_code",e).eq("status","pending").single();if(n)throw n.code==="PGRST116"?new Error("Invalid invite code"):n;if(a.user1_id===r.id)throw new Error("Cannot join your own couple");const{data:s,error:i}=await o.from("couples").update({user2_id:r.id,status:"active"}).eq("id",a.id).select().single();if(i)throw i;return s}catch(r){throw console.error("Error joining couple:",r),r}}async function f(){try{const e=await u();return e?{hasCouple:!0,couple:e,isActive:e.status==="active",isPending:e.status==="pending"}:{hasCouple:!1,couple:null,isActive:!1,isPending:!1}}catch(e){return console.error("Error getting couple status:",e),{hasCouple:!1,couple:null,isActive:!1,isPending:!1}}}export{d as c,f as g,p as j};
