import"../chunks/CWj6FrbW.js";import{i as be}from"../chunks/C2Irgtfr.js";import{o as ge}from"../chunks/iwpuV49D.js";import{aj as he,a0 as z,as as xe,am as _e,a2 as ye,at as we,au as ke,H as Se,p as Ae,c as ee,h as Ue,f as G,a as y,b as De,$ as Ie,g as e,m as x,s as a,d as U,i as w,e as f,r as u,t as T,av as Le,k as j,j as F,n as Oe}from"../chunks/DiGzQK4H.js";import{i as q}from"../chunks/CocUypoM.js";import{e as Te,i as je}from"../chunks/Dm30EB2J.js";import{r as Fe,s as qe}from"../chunks/CG4qGLFF.js";import{b as Me}from"../chunks/C5Zgnl88.js";import{p as Re}from"../chunks/CWmzcjye.js";import{g as E}from"../chunks/BAi05rh5.js";import{g as Ce,u as Ee}from"../chunks/COD4IHBN.js";import{s as Ne}from"../chunks/yeyBXsSr.js";import{g as Pe}from"../chunks/CyEOziNv.js";function te(r,c,m=!1){if(r.multiple){if(c==null)return;if(!ye(c))return we();for(var i of r.options)i.selected=c.includes(M(i));return}for(i of r.options){var b=M(i);if(ke(b,c)){i.selected=!0;return}}(!m||c!==void 0)&&(r.selectedIndex=-1)}function Je(r){var c=new MutationObserver(()=>{te(r,r.__value)});c.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Se(()=>{c.disconnect()})}function Ve(r,c,m=c){var i=new WeakSet,b=!0;he(r,"change",l=>{var _=l?"[selected]":":checked",g;if(r.multiple)g=[].map.call(r.querySelectorAll(_),M);else{var D=r.querySelector(_)??r.querySelector("option:not([disabled])");g=D&&M(D)}m(g),z!==null&&i.add(z)}),xe(()=>{var l=c();if(r===document.activeElement){var _=_e??z;if(i.has(_))return}if(te(r,l,b),b&&l===void 0){var g=r.querySelector(":checked");g!==null&&(l=M(g),m(l))}r.__value=l,b=!1}),Je(r)}function M(r){return"__value"in r?r.__value:r.value}var Be=U('<div class="min-h-screen bg-gradient-to-br from-rose-50 via-pink-50 to-fuchsia-50 flex items-center justify-center"><div class="text-center"><div class="animate-spin rounded-full h-16 w-16 border-b-2 border-rose-500 mx-auto mb-6"></div> <h2 class="text-2xl font-bold text-gray-700 mb-2">Đang kiểm tra đăng nhập...</h2> <p class="text-gray-600">Vui lòng chờ trong giây lát</p></div></div>'),He=U('<div class="min-h-screen bg-gradient-to-br from-rose-50 via-pink-50 to-fuchsia-50 flex items-center justify-center"><div class="text-center"><div class="text-6xl mb-6">🔒</div> <h2 class="text-2xl font-bold text-gray-700 mb-2">Chưa đăng nhập hoặc chưa có couple</h2> <p class="text-gray-600 mb-6">Vui lòng đăng nhập và setup couple để upload memories</p> <a href="/couple" class="inline-block bg-gradient-to-r from-rose-500 to-pink-500 hover:from-rose-600 hover:to-pink-600 text-white px-8 py-3 rounded-2xl font-semibold text-lg transition-all duration-300 shadow-xl hover:shadow-2xl transform hover:scale-105">Setup Couple 💕</a></div></div>'),We=U('<img alt="Preview" class="max-h-64 object-contain mx-auto mb-4 rounded-lg"/> <p class="text-gray-700 font-medium"> </p>',1),ze=U('<div class="text-6xl mb-4">⬆️</div> <p class="text-gray-700 font-medium mb-2">Drag & drop your photo/video here</p> <p class="text-gray-500 text-sm">or click to browse</p>',1),Ge=U("<option> </option>"),Ke=U('<div class="p-3 bg-red-50 border border-red-200 rounded-2xl"><p class="text-red-700 text-sm"> </p></div>'),Qe=U('<div class="p-3 bg-green-50 border border-green-200 rounded-2xl"><p class="text-green-700 text-sm"> </p></div>'),Xe=U('<div class="container mx-auto px-4 py-8"><div class="text-center mb-8"><h1 class="text-3xl font-bold text-pink-600 mb-2">📸 Upload New Memory</h1> <p class="text-gray-600">Share your special moments with your loved one.</p></div> <div class="max-w-2xl mx-auto bg-white/90 backdrop-blur rounded-3xl shadow-lg p-8"><form class="space-y-6"><div class="border-2 border-dashed border-pink-300 rounded-2xl p-8 text-center cursor-pointer hover:border-pink-400 transition-colors duration-200" role="button" tabindex="0"><input type="file" id="fileInput" class="hidden" accept="image/*,video/*"/> <!></div> <div><label for="albumSelect" class="block text-sm font-medium text-gray-700 mb-2">Select Album</label> <select id="albumSelect" class="w-full px-4 py-3 rounded-2xl border border-gray-200 focus:border-pink-300 focus:ring-2 focus:ring-pink-100 transition-colors duration-200 bg-white/80 backdrop-blur" required></select></div> <div><label for="captionInput" class="block text-sm font-medium text-gray-700 mb-2">Caption (Optional)</label> <input id="captionInput" placeholder="Add a sweet caption..." type="text" class="w-full px-4 py-3 rounded-2xl border border-gray-200 focus:border-pink-300 focus:ring-2 focus:ring-pink-100 transition-colors duration-200 bg-white/80 backdrop-blur"/></div> <!> <!> <button type="submit" class="w-full bg-gradient-to-r from-pink-500 to-purple-500 hover:from-pink-600 hover:to-purple-600 text-white px-6 py-3 rounded-2xl font-medium transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"> </button></form></div></div>');function ut(r,c){Ae(c,!1);let m=x([]),i=x(""),b=x(""),l=x(null),_=x(""),g=x(!1),D=x(""),S=x(""),N=x(!0),P=x(null),I=x(null);ge(async()=>{var t;if(await re(),!(!e(P)||!((t=e(I))!=null&&t.isActive)))try{a(m,await Ce()),e(m).length>0&&a(i,e(m)[0].id)}catch(n){console.error("Error loading albums:",n),a(S,"Failed to load albums. Please try again.")}});async function re(){var t,n,p;try{a(N,!0);const{data:{session:v},error:L}=await Ne.auth.getSession();if(L||!v||!v.user){E("/auth");return}if(a(P,v.user),a(I,await Pe()),!((t=e(I))!=null&&t.hasCouple)||(n=e(I))!=null&&n.isPending){E("/couple");return}if(!((p=e(I))!=null&&p.isActive)){E("/couple");return}}catch(v){console.error("Authentication check failed:",v),E("/auth")}finally{a(N,!1)}}function ae(t){var v;const p=(v=t.target.files)==null?void 0:v[0];p&&(a(l,p),a(_,URL.createObjectURL(p)),a(S,""))}function oe(t){var p;t.preventDefault();const n=(p=t.dataTransfer)==null?void 0:p.files[0];n&&(a(l,n),a(_,URL.createObjectURL(n)),a(S,""))}function ie(t){t.preventDefault()}async function le(){if(!e(l)||!e(i)){a(S,"Please select a file and an album.");return}a(g,!0),a(D,""),a(S,"");try{await Ee(e(l),e(i),e(b)||void 0),a(D,"Upload successful!");const t=new FileReader;t.onload=n=>{var k,h;const p={id:Date.now(),media_url:(k=n.target)==null?void 0:k.result,caption:e(b)||"",created_at:new Date().toISOString(),albums:{title:((h=e(m).find(R=>R.id===e(i)))==null?void 0:h.title)||"New Album"}},v=localStorage.getItem("uploadedAlbums"),L=v?JSON.parse(v):[];L.unshift(p),localStorage.setItem("uploadedAlbums",JSON.stringify(L)),typeof window<"u"&&window.refreshTimeline&&setTimeout(()=>{window.refreshTimeline()},1e3)},t.readAsDataURL(e(l)),a(l,null),a(_,""),a(b,""),typeof window<"u"&&window.refreshTimeline&&setTimeout(()=>{window.refreshTimeline()},1e3)}catch(t){console.error("Upload error:",t),a(S,t instanceof Error?t.message:"Failed to upload file.")}finally{a(g,!1)}}be();var K=ee();Ue(t=>{Ie.title="Upload - Love Timeline"});var ne=G(K);{var se=t=>{var n=Be();y(t,n)},de=t=>{var n=ee(),p=G(n);{var v=k=>{var h=He();y(k,h)},L=k=>{var h=Xe(),R=w(f(h),2),J=f(R),O=f(J),Q=f(O),ue=w(Q,2);{var ce=o=>{var s=We(),d=G(s),A=w(d,2),C=f(A,!0);u(A),T(()=>{var $;qe(d,"src",e(_)),j(C,($=e(l))==null?void 0:$.name)}),y(o,s)},pe=o=>{var s=ze();Oe(4),y(o,s)};q(ue,o=>{e(_)?o(ce):o(pe,!1)})}u(O);var V=w(O,2),B=w(f(V),2);T(()=>{e(i),Le(()=>{e(m)})}),Te(B,5,()=>e(m),je,(o,s)=>{var d=Ge(),A=f(d,!0);u(d);var C={};T(()=>{j(A,e(s).title),C!==(C=e(s).id)&&(d.value=(d.__value=e(s).id)??"")}),y(o,d)}),u(B),u(V);var H=w(V,2),X=w(f(H),2);Fe(X),u(H);var Y=w(H,2);{var ve=o=>{var s=Ke(),d=f(s),A=f(d);u(d),u(s),T(()=>j(A,`⚠️ ${e(S)??""}`)),y(o,s)};q(Y,o=>{e(S)&&o(ve)})}var Z=w(Y,2);{var fe=o=>{var s=Qe(),d=f(s),A=f(d);u(d),u(s),T(()=>j(A,`✅ ${e(D)??""}`)),y(o,s)};q(Z,o=>{e(D)&&o(fe)})}var W=w(Z,2),me=f(W,!0);u(W),u(J),u(R),u(h),T(()=>{W.disabled=e(g)||!e(l)||!e(i),j(me,e(g)?"Uploading...":"Upload Memory")}),F("change",Q,ae),F("drop",O,oe),F("dragover",O,ie),F("click",O,()=>{var o;return(o=document.getElementById("fileInput"))==null?void 0:o.click()}),Ve(B,()=>e(i),o=>a(i,o)),Me(X,()=>e(b),o=>a(b,o)),F("submit",J,Re(le)),y(k,h)};q(p,k=>{var h;!e(P)||!((h=e(I))!=null&&h.isActive)?k(v):k(L,!1)},!0)}y(t,n)};q(ne,t=>{e(N)?t(se):t(de,!1)})}y(r,K),De()}export{ut as component};
