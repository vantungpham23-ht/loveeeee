import"../chunks/CWj6FrbW.js";import{i as Et}from"../chunks/C2Irgtfr.js";import{o as St}from"../chunks/iwpuV49D.js";import{p as Dt,c as Y,h as Lt,f as I,a as s,b as Nt,$ as Tt,g as t,m,s as r,d as c,e as o,i,r as a,j as U,t as B,k as V}from"../chunks/DiGzQK4H.js";import{i as C}from"../chunks/CocUypoM.js";import{e as qt}from"../chunks/Dm30EB2J.js";import{r as lt,s as Z}from"../chunks/CG4qGLFF.js";import{b as nt}from"../chunks/C5Zgnl88.js";import{p as zt}from"../chunks/CWmzcjye.js";import{g as G}from"../chunks/BAi05rh5.js";import{s as $}from"../chunks/yeyBXsSr.js";import{g as Ft}from"../chunks/CyEOziNv.js";var It=c('<div class="min-h-screen bg-gradient-to-br from-rose-50 via-pink-50 to-fuchsia-50 flex items-center justify-center"><div class="text-center"><div class="animate-spin rounded-full h-16 w-16 border-b-2 border-rose-500 mx-auto mb-6"></div> <h2 class="text-2xl font-bold text-gray-700 mb-2">Đang kiểm tra đăng nhập...</h2> <p class="text-gray-600">Vui lòng chờ trong giây lát</p></div></div>'),Ut=c('<div class="min-h-screen bg-gradient-to-br from-rose-50 via-pink-50 to-fuchsia-50 flex items-center justify-center"><div class="text-center"><div class="text-6xl mb-6">🔒</div> <h2 class="text-2xl font-bold text-gray-700 mb-2">Chưa đăng nhập hoặc chưa có couple</h2> <p class="text-gray-600 mb-6">Vui lòng đăng nhập và setup couple để xem albums</p> <a href="/couple" class="inline-block bg-gradient-to-r from-rose-500 to-pink-500 hover:from-rose-600 hover:to-pink-600 text-white px-8 py-3 rounded-2xl font-semibold text-lg transition-all duration-300 shadow-xl hover:shadow-2xl transform hover:scale-105">Setup Couple 💕</a></div></div>'),Vt=c('<div class="flex justify-center items-center py-12"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-pink-500"></div> <span class="ml-3 text-gray-600">Loading albums...</span></div>'),Mt=c('<div class="text-center py-12"><div class="text-6xl mb-4">⚠️</div> <h2 class="text-2xl font-semibold text-gray-700 mb-2">Error</h2> <p class="text-red-600 mb-4"> </p> <button class="btn-primary">Retry</button></div>'),Ot=c('<div class="text-center py-12"><div class="text-6xl mb-4">✨</div> <h2 class="text-2xl font-semibold text-gray-700 mb-2">No albums yet!</h2> <p class="text-gray-500 mb-6">Start by creating your first album.</p> <button class="btn-primary">Create First Album</button></div>'),Pt=c('<img class="w-full h-full object-cover absolute inset-0 group-hover:scale-105 transition-transform duration-300"/>'),Rt=c('<div class="text-6xl text-pink-400">📚</div>'),Yt=c('<a class="block bg-white rounded-2xl shadow-lg hover:shadow-xl transition-shadow duration-200 overflow-hidden group"><div class="relative h-48 bg-gradient-to-br from-pink-100 to-purple-100 flex items-center justify-center"><!> <div class="absolute inset-0 bg-black bg-opacity-20 group-hover:bg-opacity-30 transition-opacity duration-200"></div> <h3 class="relative z-10 text-white text-2xl font-bold text-shadow-md"> </h3></div> <div class="p-4"><p class="text-gray-600 text-sm mb-2"> </p> <p class="text-gray-500 text-xs"> </p></div></a>'),Bt=c('<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>'),Gt=c('<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"><div class="bg-white rounded-3xl p-8 shadow-2xl max-w-md w-full"><h2 class="text-2xl font-bold text-pink-600 mb-6 text-center">Create New Album</h2> <form class="space-y-4"><div><label class="block text-sm font-medium text-gray-700 mb-2">Title</label> <input type="text" placeholder="e.g., Our First Year" required class="w-full px-4 py-3 rounded-2xl border border-gray-200 focus:border-pink-300 focus:ring-2 focus:ring-pink-100 transition-colors duration-200"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-2">Description (optional)</label> <input type="text" placeholder="A brief description of this album" class="w-full px-4 py-3 rounded-2xl border border-gray-200 focus:border-pink-300 focus:ring-2 focus:ring-pink-100 transition-colors duration-200"/></div> <div class="flex justify-end space-x-4 mt-6"><button type="button" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-2xl hover:bg-gray-300 transition-colors duration-200 font-medium">Cancel</button> <button type="submit" class="bg-gradient-to-r from-pink-500 to-purple-500 hover:from-pink-600 hover:to-purple-600 text-white px-6 py-3 rounded-2xl font-medium transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105 disabled:opacity-50"> </button></div></form></div></div>'),Ht=c('<div class="container mx-auto px-4 py-8"><div class="flex justify-between items-center mb-8"><h1 class="text-3xl font-bold text-pink-600">📚 Albums</h1> <button class="btn-primary">Create Album</button></div> <!></div> <!>',1);function se(ct,dt){Dt(dt,!1);let j=m([]),tt=m(!0),E=m(""),M=m(!1),N=m(""),O=m(""),T=m(!1),H=m(!0),J=m(null),d=m(null);St(async()=>{var e;await ut(),!(!t(J)||!((e=t(d))!=null&&e.isActive))&&await et()});async function ut(){var e,l,y;try{r(H,!0);const{data:{session:n},error:w}=await $.auth.getSession();if(w||!n||!n.user){G("/auth");return}if(r(J,n.user),r(d,await Ft()),!((e=t(d))!=null&&e.hasCouple)||(l=t(d))!=null&&l.isPending){G("/couple");return}if(!((y=t(d))!=null&&y.isActive)){G("/couple");return}}catch(n){console.error("Authentication check failed:",n),G("/auth")}finally{r(H,!1)}}async function et(){var e,l,y;try{if(console.log("Loading albums..."),!((e=t(d))!=null&&e.isActive)||!((y=(l=t(d))==null?void 0:l.couple)!=null&&y.id)){console.log("No active couple, skipping album load"),r(j,[]);return}const{data:n,error:w}=await $.from("albums").select("*").eq("couple_id",t(d).couple.id).order("created_at",{ascending:!1});w?(console.error("Supabase error:",w),r(E,`Database Error: ${w.message}`)):(console.log("Success! Albums:",n),r(j,n||[]))}catch(n){console.error("Connection error:",n),r(E,`Connection Error: ${n instanceof Error?n.message:"Unknown error"}`)}finally{r(tt,!1)}}async function vt(){if(t(N).trim()){r(M,!0);try{const{data:e,error:l}=await $.from("albums").insert({title:t(N),description:t(O)||null,couple_id:t(d).couple.id}).select().single();l?(console.error("Insert error:",l),r(E,`Insert Error: ${l.message}`)):(console.log("Album created:",e),r(j,[e,...t(j)]),r(T,!1),r(N,""),r(O,""))}catch(e){console.error("Create error:",e),r(E,`Create Error: ${e instanceof Error?e.message:"Unknown error"}`)}finally{r(M,!1)}}}Et();var rt=Y();Lt(e=>{Tt.title="Albums - Love Timeline"});var pt=I(rt);{var mt=e=>{var l=It();s(e,l)},ft=e=>{var l=Y(),y=I(l);{var n=S=>{var k=Ut();s(S,k)},w=S=>{var k=Ht(),K=I(k),Q=o(K),bt=i(o(Q),2);a(Q);var gt=i(Q,2);{var xt=u=>{var x=Vt();s(u,x)},ht=u=>{var x=Y(),P=I(x);{var q=f=>{var v=Mt(),h=i(o(v),4),D=o(h,!0);a(h);var L=i(h,2);a(v),B(()=>V(D,t(E))),U("click",L,et),s(f,v)},z=f=>{var v=Y(),h=I(v);{var D=p=>{var b=Ot(),g=i(o(b),6);a(b),U("click",g,()=>r(T,!0)),s(p,b)},L=p=>{var b=Bt();qt(b,5,()=>t(j),g=>g.id,(g,A)=>{var R=Yt(),W=o(R),at=o(W);{var wt=_=>{var F=Pt();B(()=>{Z(F,"src",t(A).cover_url),Z(F,"alt",t(A).title)}),s(_,F)},kt=_=>{var F=Rt();s(_,F)};C(at,_=>{t(A).cover_url?_(wt):_(kt,!1)})}var ot=i(at,4),At=o(ot,!0);a(ot),a(W);var st=i(W,2),X=o(st),Ct=o(X,!0);a(X);var it=i(X,2),jt=o(it);a(it),a(st),a(R),B(_=>{Z(R,"href",`/albums/${t(A).id??""}`),V(At,t(A).title),V(Ct,t(A).description||"No description"),V(jt,`Created: ${_??""}`)},[()=>new Date(t(A).created_at).toLocaleDateString()]),s(g,R)}),a(b),s(p,b)};C(h,p=>{t(j).length===0?p(D):p(L,!1)},!0)}s(f,v)};C(P,f=>{t(E)?f(q):f(z,!1)},!0)}s(u,x)};C(gt,u=>{t(tt)?u(xt):u(ht,!1)})}a(K);var _t=i(K,2);{var yt=u=>{var x=Gt(),P=o(x),q=i(o(P),2),z=o(q),f=i(o(z),2);lt(f),a(z);var v=i(z,2),h=i(o(v),2);lt(h),a(v);var D=i(v,2),L=o(D),p=i(L,2),b=o(p,!0);a(p),a(D),a(q),a(P),a(x),B(()=>{p.disabled=t(M),V(b,t(M)?"Creating...":"Create Album")}),nt(f,()=>t(N),g=>r(N,g)),nt(h,()=>t(O),g=>r(O,g)),U("click",L,()=>r(T,!1)),U("submit",q,zt(vt)),s(u,x)};C(_t,u=>{t(T)&&u(yt)})}U("click",bt,()=>r(T,!0)),s(S,k)};C(y,S=>{var k;!t(J)||!((k=t(d))!=null&&k.isActive)?S(n):S(w,!1)},!0)}s(e,l)};C(pt,e=>{t(H)?e(mt):e(ft,!1)})}s(ct,rt),Nt()}export{se as component};
